<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Terminal Pro</title>
    
    <!-- Xterm.js & Addons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>

    <!-- Application CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<!-- Header -->
<header class="header">
    <div class="header-brand">
        <span>üëæ</span>
        <span>Agent Terminal</span>
        <span id="versionBadge" class="version-badge" title="Version">-</span>
        <div id="serverStatus" class="server-status disconnected">
            <span class="dot"></span>
            <span class="status-text">Connecting...</span>
        </div>
    </div>

    <div class="header-actions">
        <!-- New Terminal Button -->
        <button class="btn-new-terminal" onclick="openNewTerminalModal()" title="Add New Terminal (Ctrl+N)">
            <span>+</span>
            <span>Terminal</span>
        </button>

        <div class="divider"></div>

        <!-- Layout Buttons with Visual Icons -->
        <div class="btn-group" id="layoutButtons">
            <button class="btn-icon layout-btn" onclick="setLayout(1)" title="Full Width" data-layout="1">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="1" y="2" width="14" height="12" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
            </button>
            <button class="btn-icon layout-btn" onclick="setLayout(2)" title="Split (Left | Right)" data-layout="2">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="1" y="2" width="6" height="12" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <rect x="9" y="2" width="6" height="12" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
            </button>
            <button class="btn-icon layout-btn" onclick="setLayout(4)" title="Grid (2√ó2)" data-layout="4">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect x="1" y="2" width="6" height="5" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <rect x="9" y="2" width="6" height="5" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <rect x="1" y="9" width="6" height="5" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <rect x="9" y="9" width="6" height="5" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
            </button>
        </div>

        <div class="divider"></div>

        <button class="btn-icon" onclick="restartServer()" title="Restart Server">üîÑ</button>
        <button class="btn-icon" onclick="showShortcuts()" title="Keyboard Shortcuts">‚å®Ô∏è</button>
    </div>
</header>

<!-- Main Container -->
<div class="main-container">
    <!-- Sidebar Toggle (when collapsed) -->
    <button class="sidebar-toggle-btn" id="sidebarToggleBtn" onclick="toggleSidebar()" title="Show Sidebar">
        ‚ò∞
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-toolbar">
            <div class="workdir-bar" id="workDirDisplay" onclick="openFolderModal()">
                Select Folder...
            </div>
            <button class="sidebar-collapse-btn" onclick="toggleSidebar()" title="Hide Sidebar">‚óÄ</button>
        </div>
        
        <div class="sidebar-section half">
            <div class="sidebar-header">
                <span>File Explorer</span>
                <span onclick="refreshFiles()" style="cursor:pointer">‚Üª</span>
            </div>
            <div class="file-tree" id="fileTree">
                <!-- Files generated by JS -->
            </div>
        </div>

        <div class="sidebar-section half" style="border:none">
            <div class="sidebar-header">Recent Projects</div>
            <div class="file-tree" id="recentProjectsList">
                <!-- List of recent projects -->
            </div>
        </div>
    </aside>

    <!-- Content -->
    <div class="content-area">
        <!-- Project Tabs -->
        <div class="project-tabs" id="projectTabs">
            <!-- Generated by JS -->
        </div>

        <!-- Project Contents (one per project) -->
        <div id="projectContents">
            <!-- Generated by JS -->
        </div>

        <!-- Empty State (when no project is open) -->
        <div class="empty-state" id="emptyState">
            <h2>Welcome to Agent Terminal</h2>
            <p>Select a folder to start a new project</p>
            <div class="agent-cards" id="emptyStateCards">
                <!-- Generated by JS -->
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<div class="modal-overlay" id="folderModal">
    <div class="modal">
        <div class="modal-header">
            <span>Open Folder</span>
            <button class="term-btn close" onclick="closeFolderModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <div style="display:flex; gap:8px; margin-bottom:12px;">
                <button class="btn" onclick="navigateUp()">‚¨Ü Up</button>
                <input type="text" id="pathInput" style="flex:1; background:var(--bg-input); border:1px solid var(--border); color:var(--text-main); padding:6px; border-radius:4px;" readonly>
            </div>
            <div id="folderList" style="display:flex; flex-direction:column; gap:2px;"></div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeFolderModal()">Cancel</button>
            <button class="btn primary" onclick="confirmFolder()">Select Folder</button>
        </div>
    </div>
</div>

<!-- New Terminal Modal -->
<div class="modal-overlay" id="newTerminalModal">
    <div class="modal" style="width: 450px;">
        <div class="modal-header">
            <span>New Terminal</span>
            <button class="term-btn close" onclick="closeNewTerminalModal()">‚úï</button>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 16px;">
                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">Select Agent</div>
                <div class="agent-grid" id="agentGrid">
                    <!-- Generated by JS -->
                </div>
            </div>
            <div>
                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">Select Role</div>
                <div class="role-selector" id="roleSelector">
                    <div class="role-option selected" data-role="General" onclick="selectRole('General')">
                        <div class="role-name">General</div>
                        <div class="role-desc">Default mode</div>
                    </div>
                    <div class="role-option" data-role="PM" onclick="selectRole('PM')">
                        <div class="role-name">PM</div>
                        <div class="role-desc">Project Manager</div>
                    </div>
                    <div class="role-option" data-role="Dev" onclick="selectRole('Dev')">
                        <div class="role-name">Dev</div>
                        <div class="role-desc">Developer</div>
                    </div>
                    <div class="role-option" data-role="QA" onclick="selectRole('QA')">
                        <div class="role-name">QA</div>
                        <div class="role-desc">Quality Assurance</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeNewTerminalModal()">Cancel</button>
            <button class="btn primary" onclick="confirmNewTerminal()">Create Terminal</button>
        </div>
    </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- Application Scripts (order matters!) -->
<script src="/static/js/state.js"></script>
<script src="/static/js/terminal.js"></script>
<script src="/static/js/ui.js"></script>
<script src="/static/js/websocket.js"></script>
<script src="/static/js/main.js"></script>

</body>
</html>
